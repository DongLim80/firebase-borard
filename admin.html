<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>관리자 페이지</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="container">
      <h1 class="brand">관리자 페이지</h1>
      <nav class="nav">
        <a href="./index.html" class="btn">게시판으로</a>
        <button id="logoutBtn" class="btn hide">로그아웃</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <section>
      <h2>역할 관리</h2>
      <p>특정 사용자 UID의 역할을 설정합니다. (처음 한 번은 콘솔에서 본인 UID로 admin 문서를 만들어 주세요)</p>
      <label>사용자 UID
        <input id="uidInput" type="text" placeholder="사용자 UID" />
      </label>
      <label>역할
        <select id="roleSelect">
          <option value="user">user</option>
          <option value="admin">admin</option>
        </select>
      </label>
      <div class="actions">
        <button id="setRoleBtn" class="btn primary">역할 저장</button>
      </div>
      <div id="adminStatus" class="status"></div>
    </section>
  </main>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script src="./app.js"></script>
  <script>
    // admin.html 전용 스크립트
    document.addEventListener('DOMContentLoaded', () => {
      const uidInput = document.getElementById('uidInput');
      const roleSelect = document.getElementById('roleSelect');
      const setRoleBtn = document.getElementById('setRoleBtn');
      const status = document.getElementById('adminStatus');
      const logoutBtn = document.getElementById('logoutBtn');

      // 로그인 상태에 따라 관리자만 접근하도록 간단 체크 (권한은 Rules가 최종 보장)
      window.whenAuthReady(async ({ user, role }) => {
        logoutBtn.classList.toggle('hide', !user);
        if (!user) {
          status.textContent = '로그인이 필요합니다.';https://github.com/DongLim80/firebase-borard/tree/main
          return;
        }
        if (role !== 'admin') {
          status.textContent = '관리자만 접근할 수 있습니다.';
          return;
        }
        status.textContent = '관리자 권한 확인됨.';
      });

      setRoleBtn.addEventListener('click', async () => {
        status.textContent = '저장 중...';
        try {
          await window.setUserRole(uidInput.value.trim(), roleSelect.value);
          status.textContent = '저장 완료!';
        } catch (e) {
          status.textContent = '오류: ' + (e?.message || e);
        }
      });

      logoutBtn.addEventListener('click', () => window.logout());
    });
  </script>
</body>
</html>
